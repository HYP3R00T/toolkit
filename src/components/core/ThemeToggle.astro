---
import { Icon } from "astro-icon/components";
import { Button } from "@/components/ui/button";
---

<Button
    id="theme-toggle"
    type="button"
    variant="ghost"
    size="icon"
    className="relative"
    aria-label="Toggle theme"
>
    <Icon
        name="theme"
        class="size-5 transition-transform duration-200 dark:rotate-180"
    />
    <span class="sr-only">Toggle theme</span>
</Button>

<script>
    function initTheme() {
        const themeToggle = document.getElementById("theme-toggle");

        // Get the current theme from localStorage or default to dark
        const getTheme = (): "light" | "dark" => {
            if (typeof localStorage !== "undefined") {
                const stored = localStorage.getItem("theme");
                if (stored === "light" || stored === "dark") {
                    return stored;
                }
            }
            // Default to dark theme
            return "dark";
        };

        // Apply theme to document
        const applyTheme = (theme: "light" | "dark") => {
            if (theme === "dark") {
                document.documentElement.classList.add("dark");
            } else {
                document.documentElement.classList.remove("dark");
            }
            localStorage.setItem("theme", theme);
        };

        // Initialize theme on page load
        applyTheme(getTheme());

        // Toggle theme on button click
        themeToggle?.addEventListener("click", () => {
            const currentTheme = document.documentElement.classList.contains(
                "dark",
            )
                ? "dark"
                : "light";
            const newTheme = currentTheme === "dark" ? "light" : "dark";
            applyTheme(newTheme);
        });
    }

    // Run on initial load and after Astro page transitions
    initTheme();
    document.addEventListener("astro:after-swap", initTheme);
</script>
